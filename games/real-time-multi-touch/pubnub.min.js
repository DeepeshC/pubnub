(function(){function G(a){if(!a)return[[0,0]];var b=[];if(a.touches&&a.touches[0])PUBNUB.each(a.touches,function(e){b.push([e.pageX,e.pageY])});else if(a.pageX)b.push([a.pageX,a.pageY]);else try{b.push([a.clientX+body.scrollLeft+doc.scrollLeft,a.clientY+body.scrollTop+doc.scrollTop])}catch(c){}return b}function t(a,b){var c=0;for(b=b||"Top";a;){c+=a["offset"+b];a=a.offsetParent}return c}function f(a){function b(){if(c.uuid&&c.joined){u.add(c);a(c)}}var c={uuid:h.uuid(function(e){c.uuid=e;b()}),joined:h.time(function(e){c.joined=
e;b()})}}function v(a){a.intervals={animate:0,move:{}};a.cell.size=Math.floor(a.image.width/a.cell.count);a.node=h.create("div");a.opacity=a.opacity||1;j(a.node,{opacity:a.opacity,position:"absolute",top:a.top,left:a.left,width:a.cell.size,height:a.image.height,backgroundRepeat:"no-repeat",backgroundImage:"url("+a.image.url+")"});n(a,0);w.appendChild(a.node);return a}function n(a,b,c){c=c||{};if(typeof c.top=="number")a.image.offset.top=c.top;if(typeof c.left=="number")a.image.offset.left=c.left;
j(a.node,{backgroundPosition:"-"+(a.cell.size*b+a.image.offset.left)+"px -"+a.image.offset.top+"px"})}function o(a,b,c,e,d){if(!d){d=0;x(a)}if(d===b.length)if(c===0)return e&&e();else{c--;d=0}var g=b[d][0]||b[d];a.intervals.animate=setTimeout(function(){n(a,g);o(a,b,c,e,d+1)},(b[d][1]||0.1)*1E3)}function y(a,b,c,e,d){if(!d){d=0;k(a)}if(d===b.length)if(c===0)return e&&e();else{c--;d=0}if(b[d][2])o(a,b[d][2],b[d][3]||0);z(a,b[d][0],b[d][1],function(){y(a,b,c,e,d+1)})}function z(a,b,c,e){var d=+new Date;
k(a);l(b,function(g,p){var m=d,A=d+c,B=a[g]||0,H=p-B,C={},q=g+p;D(a,q);a.intervals.move[q]=setInterval(function(){m=+new Date;a[g]=A<=m?p:H*(m-d)/c+B;C[g]=a[g];j(a.node,C);if(A<=m&&a.intervals.move){k(a,q);e&&e()}},Math.ceil(1E3/a.framerate))})}function k(a){clearTimeout(a.intervals.animate);l(a.intervals.move,function(b){clearInterval(a.intervals.move[b])})}function D(a,b){clearInterval(a.intervals.move[b])}function x(a){clearTimeout(a.intervals.animate)}function E(a){var b=a.uuid||"self",c=a.last;
a=a.pointers;var e=0;if(f.info)if(b!=f.info.uuid){i[b]||(i[b]={last:c,touches:[]});l(a,function(d){if(!i[b].touches[e]){i[b].touches[e]={xy:d,sprite:r.create({image:{url:"print.png",width:40,height:60,offset:{top:0,left:0}},cell:{count:1},left:d[0],top:d[1],framerate:60})};var g=Math.random();j(i[b].touches[e].sprite.node,{opacity:g<0.5?"0.5":g})}b=="self"?j(i[b].touches[e].sprite.node,{left:d[0],top:d[1]}):r.move(i[b].touches[e].sprite,{left:d[0],top:d[1]},F);e++})}}var h=PUBNUB,u=function(){var a=
{};return{add:function(b){return a[b.uuid]=b},get:function(b){return a[b]},all:function(){return a}}}(),l=h.each,w=h.search("body")[0],I=h.$,j=h.css,r={painter:function(a){w=a},create:v,setframe:n,animate:o,move:z,movie:y,stop_all:k,stop_move:D,stop_animate:x},J={players:u,current_player:f};v=h.create;var i={},s=I("painter"),F=100,K=0;r.painter(s);f={ready:0};J.current_player(function(a){f.info=a;f.ready=1;PUBNUB.subscribe({channel:"pubnub-multi-touch",callback:E})});var L=function(a,b){var c,e=0,
d=function(){if(e+b>+new Date){clearTimeout(c);c=setTimeout(d,b)}else{e=+new Date;a()}};return d}(function(){f.ready&&PUBNUB.publish({channel:"pubnub-multi-touch",message:{pointers:f.pointers,uuid:f.info.uuid,last:K++}})},F);PUBNUB.bind("mouseup,mousedown,mousemove,touchmove,touchstart,touchend,selectstart",document,function(a){a=f.pointers=G(a);var b=t(s,"Top"),c=t(s,"Left");l(a,function(e){e[0]-=c+20;e[1]-=b+60});E({pointers:f.pointers,uuid:"",now:+new Date});L()})})();
